---
title: 用wifi棒子操纵ROS2机器人
permalink: /docs/zh/eight-on-openstick
key: docs-zh-eight-on-openstick
mermaid: true
---
<style>
.flowchart-link{stroke: green !important;}
#flowchart-pointEnd {fill: green !important;stroke: green !important;}
#flowchart-pointStart {fill: green !important;stroke: green !important;}
text.actor > tspan {fill: green !important;font-size: 16px !important;font-weight:bold !important;}
#arrowhead path {fill: green !important;}   
.messageText {fill: green !important;font-size: 16px !important;font-weight:bold !important;}
.messageLine0 {stroke: green !important;}
.messageLine1 {stroke: green !important;}
.relation {stroke: green !important;stroke-width: 2 !important;}
th {
	background: #dddddd;
	word-wrap: break-word;
	text-align: center;
}
tr:nth-child(odd) {   
  background-color: #c0e1ff;
  color: #222; 
}
tr:nth-child(even) {
  background-color: #fef6de;
  color: #222;
}
</style>

本章属于人类迷惑行为:rofl::rofl:

### 设备简介和系统部署

这次的主角是。。。一根棒子，喏，就它

![wifi棒子](/eight/assets/images/stick1.jpg){:.rounded width="720px" style="display:block; margin-left:auto; margin-right:auto"}

![wifi棒子](/eight/assets/images/stick2.jpg){:.rounded width="720px" style="display:block; margin-left:auto; margin-right:auto"}

自从高通MSM8916的Mainlining开源后，各种古董设备就被玩出了花。10年前的红米手机变身klipper上位机后，身价也是水涨船高。而国内的运营商们，出于内卷的原因，向市场投放了一批售价仅9.9元的4g wifi棒子。有好事者拆开后发现芯片竟是Snapdragon 410，就开发了一个openstick项目将Mainlining迁移到棒子上了。然后棒子立马被抢购一空，我也跟风买了一根。

具体的配置不高，Snapdragon 410是高通第一款64位arm处理器，上市于2013年底，距今整整10年。Cortex-A53架构，四核1.2g。棒子给它搭载了512m内存和4g的rom，勉强算够用。openstick是基于debian 11（bullseye）的，刷机教程满网都是我就不放连接了。当初刷完机后剩余2.5g左右空间，自带了一个openjdk 1.8，于是就跑了个eight，几个示例都能运行。然后...，就丢一边落灰了。为啥呢？因为实在想不到应用场景。这东西除了个供电的usb接口（当然可以驱动成一个无线网卡）就没有一个外设接口，所以不能像树莓派那样做设备服务器；又因为资源太少，连个正经数据库跑起来也挺艰难，所以又做不了应用服务器。网上倒是有卖扩展坞的，卖的比棒子还贵几倍，有那钱不如出去吃烤串。于是，跑过eight后，想不出有啥用，只能丢一边去了，可惜了性能还算不错的cpu。

前几天翻古物堆又翻出它来，突然想到了ROS。`ROS实质上是个网络总线的域控制器`{:.error}，只要有网络，就能将同一子网内的所有ROS外设们驱动起来，相当于拿网络当I/O接口。那么，这不就完美的扩展了棒子的外设吗？棒子正好是个4g热点，天生是带wifi子网的，如果上面能跑Eight on ROS，那不就可以操纵无人车了吗？

说干就干，开刷ROS2。可仔细一看傻眼了，ROS2确实支持debian bullseye，但却是tier 3，不提供二进制包，只能自己编译。剩下的选项就是棒子本地编译还是交叉编译了。本地编译资源实在太少，但交叉编译搭环境又太麻烦，稍不小心还容易出错，设备的依赖库也是个问题。于是心一横，还是委屈一下棒子吧:sweat_smile:。

接下来，就是一场噩梦。希望大家不要去尝试，后面我会把编译好的镜像放出来给各位刷机(镜像就在之前虚拟机存放的云空间里：[百度云盘](https://pan.baidu.com/s/1n36sOWviHADT4HxKs9jFfw)，提取码为 bo5c)。

具体说来，要编译ROS2的全家桶，再加rcljava，对内存和磁盘空间需求很高。棒子本身的资源根本不够。内存的需求是至少2g，磁盘需要20g左右。该如何解决呢？先解决内存，使用棒子rom剩余空间，设一个2g左右的swap，然后挂载虚拟内存。于是基本上没有磁盘了，要编译只能挂载网络文件系统，openstick是不支持的，于是编译一个内核，把cifs模块挂载上去，然后拿一台linux服务器开samba，这样算是解决了磁盘空间问题。接着就是漫长难熬，且反复失败的编译过程，整整花了5天，就是一场行为艺术，棒子也是九死一生。接下来记录一下编译的若干要点。



